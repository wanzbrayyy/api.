<div id="langModal" class="lang-modal-overlay">
    <div class="lang-modal">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <h3 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                <i class="fa-solid fa-earth-americas" style="color: #3b82f6;"></i> Select Language
            </h3>
            <button onclick="toggleLangModal()" style="background: none; border: none; color: #94a3b8; font-size: 1.5rem; cursor: pointer;">&times;</button>
        </div>
        <p style="color: #64748b; font-size: 0.9rem;">Choose your preferred region & language.</p>

        <div class="lang-grid">
            <% langList.forEach(lang => { %>
                <a href="/<%= lang.code %>/dashboard" class="lang-item <%= currentLang === lang.code ? 'active' : '' %>">
                    <i class="fa-solid <%= lang.icon %> lang-flag" style="color: <%= lang.color %>;"></i>
                    <span style="font-weight: 500;"><%= lang.name %></span>
                </a>
            <% }) %>
        </div>
    </div>
</div>

<script>
    function toggleLangModal() {
        const modal = document.getElementById('langModal');
        modal.classList.toggle('active');
    }

    // Auto translate texts based on currentLang (Client Side Helper)
    // Since we use server scraper, full page translation happens via URL reload.
    // This script adds visual feedback.
    document.addEventListener('DOMContentLoaded', () => {
        const currentPath = window.location.pathname;
        const links = document.querySelectorAll('a');
        const langPrefix = "/<%= currentLang %>";
        
        links.forEach(link => {
            const href = link.getAttribute('href');
            // Fix internal links to keep language prefix
            if (href && href.startsWith('/') && !href.startsWith('/api') && !href.startsWith(langPrefix)) {
                if (href === '/login' || href === '/register' || href === '/') {
                   // Auth pages logic
                   link.href = langPrefix + href.replace('/' + currentLang, ''); 
                } else if (!href.startsWith('/http')) {
                   // Keep existing logic or let the middleware redirect
                }
            }
        });
    });
</script>