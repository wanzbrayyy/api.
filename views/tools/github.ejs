<!DOCTYPE html>
<html lang="en">
<%- include('../partials/head') %>
<body>
    <%- include('../partials/navbar', { user: user }) %>
    <div class="main-wrapper container animate__animated animate__fadeIn">
        <div class="glass-panel" style="max-width: 800px; margin: 0 auto; padding: 30px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;"><i class="fa-brands fa-github"></i> Github API Tester</h2>
                <span class="status-badge" id="statusCode">READY</span>
            </div>

            <div class="input-group">
                <span style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 5px; display: block;">Endpoint: GET /api/tools/github</span>
                <input type="text" id="param" class="input-modern" placeholder="Enter username (e.g. wanzbrayyy)">
            </div>
            
            <button onclick="fetchApi()" class="btn-modern" style="width: 100%; margin-top: 15px;">
                Send Request <i class="fa-solid fa-paper-plane"></i>
            </button>

            <div class="response-container" style="margin-top: 30px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <strong style="color: #cbd5e1;">Response Body (JSON)</strong>
                    <button onclick="copyJson()" style="background: none; border: none; color: var(--primary); cursor: pointer;">Copy</button>
                </div>
                <pre id="jsonOutput" style="background: #0f172a; padding: 20px; border-radius: 10px; overflow-x: auto; color: #a5b4fc; font-family: monospace; min-height: 200px; border: 1px solid var(--glass-border);">// Response will appear here...</pre>
            </div>
        </div>
    </div>

    <script>
        const userApiKey = "<%= user.apiKey || '' %>";

        async function fetchApi() {
            const param = document.getElementById('param').value;
            const output = document.getElementById('jsonOutput');
            const statusBadge = document.getElementById('statusCode');
            
            if(!userApiKey) return alert("Please generate API Key in Profile first!");
            if(!param) return alert("Please enter parameter");

            output.innerText = "Processing...";
            statusBadge.innerText = "WAIT...";
            statusBadge.style.background = "#fbbf24";

            try {
                const startTime = Date.now();
                const req = await fetch(`/api/tools/github?username=${param}&apikey=${userApiKey}`);
                const data = await req.json();
                const duration = Date.now() - startTime;

                statusBadge.innerText = `${req.status} ${req.statusText} (${duration}ms)`;
                statusBadge.style.background = req.ok ? "#22c55e" : "#ef4444";
                
                output.innerText = JSON.stringify(data, null, 4);
            } catch(e) {
                statusBadge.innerText = "ERROR";
                statusBadge.style.background = "#ef4444";
                output.innerText = JSON.stringify({ error: e.message }, null, 4);
            }
        }
        function copyJson() {
            navigator.clipboard.writeText(document.getElementById('jsonOutput').innerText);
            alert("Copied!");
        }
    </script>
    <style>
        .status-badge {
            background: #64748b;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: bold;
        }
    </style>
</body>
</html>